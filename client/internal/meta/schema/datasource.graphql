extend type DataConnection {
    datasources: [Datasource!]! @goField(forceResolver: true)
}

extend type Query {
  """
  Returns the complete list of all versions a DataConnectionModule's definition.
  """
  dataConnectionModuleVersions(id: String!, workspaceId: ObjectId!, latest: Boolean): [DataConnectionModuleVersion!]!
  """
  Returns the list of all Datasources for a given DataConnection.
  """
  getDatasourcesByConnection(dataConnectionId: ObjectId!): [Datasource]!
}

extend type Query {
    datasource(id: ObjectId!): Datasource!
    searchDatasource(workspaceId: ObjectId, folderId: ObjectId, nameExact: String, nameSubstring: String): DatasourceSearchResult!
    dataConnection(id: ObjectId!): DataConnection!
    searchDataConnection(workspaceId: ObjectId, folderId: ObjectId, nameExact: String, nameSubstring: String, moduleID: String): DataConnectionSearchResult!
}

extend type Mutation {
    createDatasource(workspaceId: ObjectId!, input: DatasourceInput!): Datasource!
    updateDatasource(id: ObjectId!, input: DatasourceInput!): Datasource!
    deleteDatasource(id: ObjectId!): ResultStatus!
    createDataConnection(workspaceId: ObjectId!, input: DataConnectionInput!): DataConnection!
    updateDataConnection(id: ObjectId!, input: DataConnectionInput!): DataConnection!
    deleteDataConnection(id: ObjectId!): ResultStatus!
}

enum DatasetType @goModel(model: "observe/meta/metatypes.DatasetType") {
  k8s_entity
  otellogs
  otelmetrics
  oteltraces
  prometheus
}

enum DatasourceState @goModel(model: "observe/meta/metatypes.DatasourceState") {
  Error
  Pending
  Running
}

enum DatasourceType @goModel(model: "observe/meta/metatypes.DatasourceType") {
  Filedrop
  Poller
  Token
}

type DataVariable @goModel(model: "observe/meta/metatypes.DataVariable") {
    name: String!
    title: String
    type: String!
    description: String
    required: Boolean!
    sensitive: Boolean
    default: String
    advanced: Boolean
    validValues: [String!]
    value: String
}

input DataVariableInput @goModel(model: "observe/meta/metatypes.DataVariableInput") {
    name: String!
    title: String
    value: String
}


type DatasourceConfig @goModel(model: "observe/meta/metatypes.DatasourceConfig") {
    datasourceFiledropConfig: DatasourceFiledropConfig
    awsMetricsPollerConfig: AWSMetricsPollerConfig
    awsCollectionStackConfig: AWSCollectionStackConfig
}

input DatasourceConfigInput @goModel(model: "observe/meta/metatypes.DatasourceConfigInput") {
    awsMetricsPollerConfig: AWSMetricsPollerConfigInput
    awsCollectionStackConfig: AWSCollectionStackConfigInput
}


type DatasourceFiledropConfig @goModel(model: "observe/meta/metatypes.DatasourceFiledropConfig") {
    filedrop: Filedrop! @goField(forceResolver: true)
    destinationUri: String!
    dataAccessPointArn: String!
}

input DatasourceFiledropConfigInput @goModel(model: "observe/meta/metatypes.DatasourceFiledropConfigInput") {
    filedropID: ObjectId!
    destinationUri: String!
    dataAccessPointArn: String!
}


type AWSMetricsPollerConfig @goModel(model: "observe/meta/metatypes.AWSMetricsPollerConfig") {
    poller: Poller! @goField(forceResolver: true)
}

input AWSMetricsPollerConfigInput @goModel(model: "observe/meta/metatypes.AWSMetricsPollerConfigInput") {
    cloudWatchMetricsConfig: [AWSPollerMetricsInput!]!
    interval: Duration!
}


type AWSCollectionStackConfig @goModel(model: "observe/meta/metatypes.AWSCollectionStackConfig") {
    configDeliveryBucketName: String
    logGroupNamePatterns: [String!]
    excludeLogGroupNamePatterns: [String!]
    sourceBucketNames: [String!]
    awsServiceMetricsList: [AWSServiceMetrics!]
    customMetricsList: [AWSServiceMetrics!]
    configResourceList: [String!]
}

input AWSCollectionStackConfigInput @goModel(model: "observe/meta/metatypes.AWSCollectionStackConfigInput") {
    configDeliveryBucketName: String
    logGroupNamePatterns: [String!]
    excludeLogGroupNamePatterns: [String!]
    sourceBucketNames: [String!]
    awsServiceMetricsList: [AWSServiceMetricsInput!]
    customMetricsList: [AWSServiceMetricsInput!]
    configResourceList: [String!]
}


type AWSServiceMetrics @goModel(model: "observe/meta/metatypes.AWSServiceMetrics") {
    namespace: String!
    metricNames: [String!]!
}

input AWSServiceMetricsInput @goModel(model: "observe/meta/metatypes.AWSServiceMetricsInput") {
    namespace: String!
    metricNames: [String!]!
}


type AWSPollerMetrics @goModel(model: "observe/meta/metatypes.AWSPollerMetrics") {
    namespace: String!
    metricNames: [String!]
    tagFilters: [TagFilter!]
    dimensions: [DimensionFilter!]
}

input AWSPollerMetricsInput @goModel(model: "observe/meta/metatypes.AWSPollerMetricsInput") {
    namespace: String!
    metricNames: [String!]
    tagFilters: [TagFilterInput!]
    dimensions: [DimensionFilterInput!]
}


type TagFilter @goModel(model: "observe/meta/metatypes.TagFilter") {
    key: String!
    values: [String!]!
}

input TagFilterInput @goModel(model: "observe/meta/metatypes.TagFilterInput") {
    key: String!
    values: [String!]!
}


type DimensionFilter @goModel(model: "observe/meta/metatypes.DimensionFilter") {
    name: String!
    value: String!
}

input DimensionFilterInput @goModel(model: "observe/meta/metatypes.DimensionFilterInput") {
    name: String!
    value: String!
}


type DatasourceInstruction @goModel(model: "observe/meta/metatypes.DatasourceInstruction") {
    clientStackAttributeValues: JsonObject!
    template: String!
}




type DatasourceDefinition @goModel(model: "observe/meta/metatypes.DatasourceDefinition") {
    name: String!
    description: String!
    type: String!
    inputs: [DataVariable!]!
    clientStackAttributeSchemas: [DataVariable!]!
    instructions: [DatasourceInstruction!]!
}




type DatasourceStatus @goModel(model: "observe/meta/metatypes.DatasourceStatus") {
    state: DatasourceState!
    details: JsonObject
}




type Datasource implements WorkspaceObject & AuditedObject & FolderObject @goModel(model: "observe/meta/metatypes.Datasource") {
    dataConnectionID: ObjectId!
    datastreamID: ObjectId!
    datastreamTokenID: String
    type: DatasourceType
    status: DatasourceStatus!
    clientStackAttributes: [DataVariable!]!
    variables: [DataVariable!]!
    config: DatasourceConfig
    id: ObjectId!
    workspaceId: ObjectId!
    name: String!
    iconUrl: String
    description: String
    managedById: ObjectId
    managedBy: WorkspaceObject @goField(forceResolver: true)

    folderId: ObjectId!

    createdBy: UserId!
    createdDate: Time!
    createdByInfo: UserInfo! @goField(forceResolver: true)
    updatedBy: UserId!
    updatedDate: Time!
    updatedByInfo: UserInfo! @goField(forceResolver: true)
}

input DatasourceInput @goModel(model: "observe/meta/metatypes.DatasourceInput") {
    dataConnectionID: ObjectId!
    datastreamID: ObjectId!
    datastreamTokenID: String
    type: DatasourceType
    clientStackAttributes: [DataVariableInput!]!
    variables: [DataVariableInput!]!
    config: DatasourceConfigInput
    name: String!
    iconUrl: String
    description: String
    managedById: ObjectId

    folderId: ObjectId
}

type DatasourceSearchResult @goModel(model: "observe/meta/metatypes.DatasourceSearchResult") {
    results: [Datasource!]!
}

type RequiredDatasetDefinition @goModel(model: "observe/meta/metatypes.RequiredDatasetDefinition") {
    type: DatasetType!
}




type DatastreamDefinition @goModel(model: "observe/meta/metatypes.DatastreamDefinition") {
    name: String!
    supportedTypes: [RequiredDatasetDefinition!]!
}




type DataConnectionOutputs @goModel(model: "observe/meta/metatypes.DataConnectionOutputs") {
    name: String!
    target: String!
    datasetName: String
    metricName: String
}




type DataConnectionModuleVersion @goModel(model: "observe/meta/metatypes.DataConnectionModuleVersion") {
    id: String!
    appID: String!
    version: String!
    changelog: String!
    readme: String!
    source: String!
    variableInputs: [DataVariable!]!
    datasourceDefinitions: [DatasourceDefinition!]!
    outputs: [DataConnectionOutputs!]!
    defaultDatastream: DatastreamDefinition! @deprecated(reason:"This was moved to an array field `defaultDatastreams`. You should use that field instead of this.")
    defaultDatastreams: [DatastreamDefinition!]!
}




type DataConnection implements WorkspaceObject & AuditedObject & FolderObject @goModel(model: "observe/meta/metatypes.DataConnection") {
    moduleID: String!
    version: String!
    changelog: String!
    readme: String!
    source: String!
    variables: [DataVariable!]!
    outputs: [DataConnectionOutputs!]!
    defaultDatastreams: [DatastreamDefinition!]!
    id: ObjectId!
    workspaceId: ObjectId!
    name: String!
    iconUrl: String
    description: String
    managedById: ObjectId
    managedBy: WorkspaceObject @goField(forceResolver: true)

    folderId: ObjectId!

    createdBy: UserId!
    createdDate: Time!
    createdByInfo: UserInfo! @goField(forceResolver: true)
    updatedBy: UserId!
    updatedDate: Time!
    updatedByInfo: UserInfo! @goField(forceResolver: true)
}

input DataConnectionInput @goModel(model: "observe/meta/metatypes.DataConnectionInput") {
    moduleID: String!
    version: String!
    variables: [DataVariableInput!]!
    name: String!
    iconUrl: String
    description: String
    managedById: ObjectId

    folderId: ObjectId
}

type DataConnectionSearchResult @goModel(model: "observe/meta/metatypes.DataConnectionSearchResult") {
    results: [DataConnection!]!
}

