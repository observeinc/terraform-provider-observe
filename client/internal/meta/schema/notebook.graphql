extend type Query {
    investigationNotebook(id: ObjectId!): InvestigationNotebook!
    searchInvestigationNotebook(workspaceId: ObjectId, folderId: ObjectId, nameExact: String, nameSubstring: String): InvestigationNotebookSearchResult!
}

extend type Mutation {
    createInvestigationNotebook(workspaceId: ObjectId!, input: InvestigationNotebookInput!): InvestigationNotebook!
    updateInvestigationNotebook(id: ObjectId!, input: InvestigationNotebookInput!): InvestigationNotebook!
    deleteInvestigationNotebook(id: ObjectId!): ResultStatus!
}

"""
Skip means that the initial investigation will not be run automatically when creating a notebook. Run means that it will be run automatically.
"""
enum InitialInvestigationMode @goModel(model: "observe/meta/metatypes.InitialInvestigationMode") {
  Run
  Skip
}

"""
The agent that a tool call is associated with.
"""
enum NotebookAIAgent @goModel(model: "observe/meta/metatypes.NotebookAIAgent") {
  Observe
  Orchestration
}

enum NotebookActionConfirmation @goModel(model: "observe/meta/metatypes.NotebookActionConfirmation") {
  No
  Pending
  Yes
}

"""
Replace means that this block will replace the parent block. Reference means that this block will be a reference ("reply to") to the parent block.
We want to keep the different versions of the block in the list, so everything is still append-only. To keep things simple, the backend will
complain if you try to have a block replace a replacement block. E.g. if block A tries to replace B, but B is a replacement of C, you should just
specify that you want to replace C directly.
"""
enum NotebookBlockRelation @goModel(model: "observe/meta/metatypes.NotebookBlockRelation") {
  Reference
  Replace
}

enum NotebookBlockType @goModel(model: "observe/meta/metatypes.NotebookBlockType") {
  actionChoices
  actionPing
  actionRaiseIncident
  actionTicket
  contentImage
  contentMarkdown
  contentQuery
  frontendQueryGenerationApi
  o11yPlaceholder
  o11yPromptRecord
}

enum NotebookQueryRenderType @goModel(model: "observe/meta/metatypes.NotebookQueryRenderType") {
  KubernetesClusterList
  KubernetesConfigMapList
  KubernetesCronJobList
  KubernetesDaemonSetList
  KubernetesDeploymentList
  KubernetesIngressList
  KubernetesJobList
  KubernetesNamespaceList
  KubernetesNodeList
  KubernetesPersistentVolumeClaimList
  KubernetesPersistentVolumeList
  KubernetesPodList
  KubernetesReplicaSetList
  KubernetesSecretList
  KubernetesServiceList
  KubernetesStatefulSetList
  ServiceList
  TraceFlamechart
}

enum NotebookRequestedQueryType @goModel(model: "observe/meta/metatypes.NotebookRequestedQueryType") {
  metric
}

type NotebookBlock @goModel(model: "observe/meta/metatypes.NotebookBlock") {
    type: NotebookBlockType!
    properties: NotebookBlockProperties!
    """
    A unique UUID for this block
    """
    id: String
    """
    The hash of the content of this block
    """
    contentHash: String!
    """
    The user who created this block
    """
    author: UserId!
    """
    The time this block was created
    """
    createdAt: Time!
    """
    The parent block of this block
    """
    parent: String
    parentRelation: NotebookBlockRelation
    """
    Any debugging metadata about this block. E.g. timing information, the tool call that made it, etc.
    """
    metadata: JsonObject
}

input NotebookBlockInput @goModel(model: "observe/meta/metatypes.NotebookBlockInput") {
    type: NotebookBlockType!
    properties: NotebookBlockPropertiesInput!
    id: String
    parent: String
    parentRelation: NotebookBlockRelation
    metadata: JsonObject
}


type NotebookContextValue @goModel(model: "observe/meta/metatypes.NotebookContextValue") {
    name: String!
    value: NotebookContextValueInstance!
}

input NotebookContextValueInput @goModel(model: "observe/meta/metatypes.NotebookContextValueInput") {
    name: String!
    value: NotebookContextValueInstanceInput!
}


type NotebookContext @goModel(model: "observe/meta/metatypes.NotebookContext") {
    """
    A list of key value pairs that represent different pieces of the context of the notebook.
    """
    context: [NotebookContextValue!]!
    """
    Any user specified context strings the user would like to add to the notebook. E.g. "I don't care about collector errors."
    """
    notes: [String!]!
}

input NotebookContextInput @goModel(model: "observe/meta/metatypes.NotebookContextInput") {
    context: [NotebookContextValueInput!]!
    notes: [String!]!
}


type InvestigationNotebook implements WorkspaceObject & AuditedObject & FolderObject @goModel(model: "observe/meta/metatypes.InvestigationNotebook") {
    """
    The alert that triggered this notebook (if any).
    """
    alert: NotebookAlertInfo @deprecated(reason:"This was moved to a more general `triggerContext`. You should use that field instead of this.")
    """
    The context of the investigation
    """
    context: NotebookContext
    """
    The runbook associated with this notebook (if any)
    """
    runbook: NotebookRunbookInfo
    """
    The context from which this notebook was generated
    """
    triggerContext: InvestigationNotebookTriggerContext
    """
    The incident that this notebook is associated with
    """
    incident: Incident! @goField(forceResolver: true)
    """
    The ID of the incident that this notebook is associated with. We will allocate a new Incident automatically if not specified on create.
    """
    incidentID: ObjectId
    """
    The list of blocks in this notebook. This is only optional so that it doesn't have to be specified on update.
    """
    blocks: [NotebookBlock!]
    """
    The ID of the initial investigation task for this notebook. Only returned when the notebook is created and the initial investigation task is running.
    """
    taskID: ObjectId
    """
    The AI-generated summary of the notebook
    """
    summary: String!
    """
    The hash of the blocks in this notebook.
    """
    blockHash: String!
    """
    The AI jobs associated with this notebook
    """
    activeJobs: [NotebookInstructionJobState!]! @goField(forceResolver: true)
    """
    The timezone of the notebook. Must be in IANA format. "Etc/UTC" by default.
    """
    timezone: String
    id: ObjectId!
    workspaceId: ObjectId!
    name: String!
    iconUrl: String
    description: String
    managedById: ObjectId
    managedBy: WorkspaceObject @goField(forceResolver: true)

    folderId: ObjectId!

    createdBy: UserId!
    createdDate: Time!
    createdByInfo: UserInfo! @goField(forceResolver: true)
    updatedBy: UserId!
    updatedDate: Time!
    updatedByInfo: UserInfo! @goField(forceResolver: true)
}

input InvestigationNotebookInput @goModel(model: "observe/meta/metatypes.InvestigationNotebookInput") {
    alert: NotebookAlertInfoInput
    context: NotebookContextInput
    runbook: NotebookRunbookInfoInput
    triggerContext: InvestigationNotebookTriggerContextInput
    incidentID: ObjectId
    blocks: [NotebookBlockInput!]
    initialInvestigationMode: InitialInvestigationMode
    clearNotebookBlocks: Boolean
    timezone: String
    name: String!
    iconUrl: String
    description: String
    managedById: ObjectId

    folderId: ObjectId
}

type InvestigationNotebookSearchResult @goModel(model: "observe/meta/metatypes.InvestigationNotebookSearchResult") {
    results: [InvestigationNotebook!]!
}

type InvestigationNotebookTriggerContext @goModel(model: "observe/meta/metatypes.InvestigationNotebookTriggerContext") {
    """
    The source URL from which this notebook was generated. This is useful to link back to where the user created the investigation (for e.g. the alarm url). This will be null if the investigation was triggered just by clicking "New Investigation" or in the home page.
    """
    sourceUrl: String
    """
    The monitor ID from which this notebook was generated, or associated with the alarm from which this notebook was generated (if any)
    """
    monitorID: ObjectId
    """
    The alarm ID from which this notebook was generated (if any)
    """
    alarmID: String
    """
    The monitor from which this notebook was generated, or associated with the alarm from which this notebook was generated (if any)
    """
    monitor: MonitorV2
    """
    The alarm from which this notebook was generated (if any)
    """
    alarm: MonitorV2Alarm
    """
    Whether this notebook was generated in dry run mode.
    """
    isDryRun: Boolean
}

input InvestigationNotebookTriggerContextInput @goModel(model: "observe/meta/metatypes.InvestigationNotebookTriggerContextInput") {
    sourceUrl: String
    monitorID: ObjectId
    alarmID: String
    isDryRun: Boolean
}


type NotebookAlertInfo @goModel(model: "observe/meta/metatypes.NotebookAlertInfo") {
    monitorID: ObjectId!
    alertID: String!
    status: MonitorV2RollupStatus!
    level: MonitorV2AlarmLevel!
    triggeredAt: Time!
    duration: Duration!
    monitorUrl: String!
    alertUrl: String!
    monitorDescription: String!
}

input NotebookAlertInfoInput @goModel(model: "observe/meta/metatypes.NotebookAlertInfoInput") {
    monitorID: ObjectId!
    alertID: String!
}


type NotebookBlockProperties @goModel(model: "observe/meta/metatypes.NotebookBlockProperties") {
    markdown: NotebookMarkdown
    frontendQueryGenerationApi: NotebookFrontendQueryGenerationApi
    query: NotebookQuery
    image: NotebookImage
    raiseIncident: NotebookRaiseIncidentAction
    ping: NotebookPingAction
    ticket: NotebookTicketAction
    o11yPlaceholder: NotebookO11yPlaceholder
    o11yPromptRecord: NotebookO11yPromptRecord
    choices: NotebookChoices
}

input NotebookBlockPropertiesInput @goModel(model: "observe/meta/metatypes.NotebookBlockPropertiesInput") {
    markdown: NotebookMarkdownInput
    frontendQueryGenerationApi: NotebookFrontendQueryGenerationApiInput
    query: NotebookQueryInput
    image: NotebookImageInput
    raiseIncident: NotebookRaiseIncidentActionInput
    ping: NotebookPingActionInput
    ticket: NotebookTicketActionInput
    o11yPlaceholder: NotebookO11yPlaceholderInput
    o11yPromptRecord: NotebookO11yPromptRecordInput
    choices: NotebookChoicesInput
}


type NotebookMarkdown @goModel(model: "observe/meta/metatypes.NotebookMarkdown") {
    text: String!
}

input NotebookMarkdownInput @goModel(model: "observe/meta/metatypes.NotebookMarkdownInput") {
    text: String!
}


type NotebookImage @goModel(model: "observe/meta/metatypes.NotebookImage") {
    """
    The base64 encoded image
    """
    base64: String
    """
    The url of the image
    """
    url: String
    description: String!
}

input NotebookImageInput @goModel(model: "observe/meta/metatypes.NotebookImageInput") {
    base64: String
    url: String
    description: String!
}


type NotebookRaiseIncidentAction @goModel(model: "observe/meta/metatypes.NotebookRaiseIncidentAction") {
    preview: NotebookActionPreview!
    summary: String!
    severity: String!
    slack: NotebookSlackInfo!
    teams: [String!]!
    incidentOwner: String!
    confirmation: NotebookActionConfirmation!
}

input NotebookRaiseIncidentActionInput @goModel(model: "observe/meta/metatypes.NotebookRaiseIncidentActionInput") {
    preview: NotebookActionPreviewInput!
    summary: String!
    severity: String!
    slack: NotebookSlackInfoInput!
    teams: [String!]!
    incidentOwner: String!
    confirmation: NotebookActionConfirmation!
}


type NotebookPingAction @goModel(model: "observe/meta/metatypes.NotebookPingAction") {
    preview: NotebookActionPreview!
    user: String!
    confirmation: NotebookActionConfirmation!
}

input NotebookPingActionInput @goModel(model: "observe/meta/metatypes.NotebookPingActionInput") {
    preview: NotebookActionPreviewInput!
    user: String!
    confirmation: NotebookActionConfirmation!
}


type NotebookTicketAction @goModel(model: "observe/meta/metatypes.NotebookTicketAction") {
    preview: NotebookActionPreview!
    name: String!
    description: String!
    priority: String!
    confirmation: NotebookActionConfirmation!
}

input NotebookTicketActionInput @goModel(model: "observe/meta/metatypes.NotebookTicketActionInput") {
    preview: NotebookActionPreviewInput!
    name: String!
    description: String!
    priority: String!
    confirmation: NotebookActionConfirmation!
}


type NotebookChoiceToolCall @goModel(model: "observe/meta/metatypes.NotebookChoiceToolCall") {
    agentName: NotebookAIAgent!
    toolName: String!
    toolCallParams: JsonObject!
}

input NotebookChoiceToolCallInput @goModel(model: "observe/meta/metatypes.NotebookChoiceToolCallInput") {
    agentName: NotebookAIAgent!
    toolName: String!
    toolCallParams: JsonObject!
}


type NotebookChoice @goModel(model: "observe/meta/metatypes.NotebookChoice") {
    choiceID: String!
    text: String!
    kgValues: JsonObject!
    toolCall: NotebookChoiceToolCall!
    origChoiceText: String!
    confidenceScore: Int64!
}

input NotebookChoiceInput @goModel(model: "observe/meta/metatypes.NotebookChoiceInput") {
    choiceID: String!
    text: String!
    kgValues: JsonObject!
    toolCall: NotebookChoiceToolCallInput!
    origChoiceText: String!
    confidenceScore: Int64!
}


type NotebookChoices @goModel(model: "observe/meta/metatypes.NotebookChoices") {
    question: String!
    choices: [NotebookChoice!]!
    active: Boolean!
}

input NotebookChoicesInput @goModel(model: "observe/meta/metatypes.NotebookChoicesInput") {
    question: String!
    choices: [NotebookChoiceInput!]!
    active: Boolean!
}


type NotebookFrontendQueryGenerationApi @goModel(model: "observe/meta/metatypes.NotebookFrontendQueryGenerationApi") {
    type: NotebookRequestedQueryType!
    timeRange: NotebookQueryLayoutTimeRange!
    filters: [NotebookRequestedQueryFilters!]
    typeSpecificProperties: NotebookRequestedQueryTypeSpecificProperties!
    query: MultiStageQuery
}

input NotebookFrontendQueryGenerationApiInput @goModel(model: "observe/meta/metatypes.NotebookFrontendQueryGenerationApiInput") {
    type: NotebookRequestedQueryType!
    timeRange: NotebookQueryLayoutTimeRangeInput!
    filters: [NotebookRequestedQueryFiltersInput!]
    typeSpecificProperties: NotebookRequestedQueryTypeSpecificPropertiesInput!
    query: MultiStageQueryInput
}


type NotebookQuery @goModel(model: "observe/meta/metatypes.NotebookQuery") {
    query: MultiStageQuery!
    """
    The render type of the query, needed for the FE to know how to render the query. Null if no special rendering is needed.
    """
    renderType: NotebookQueryRenderType
    description: String!
}

input NotebookQueryInput @goModel(model: "observe/meta/metatypes.NotebookQueryInput") {
    query: MultiStageQueryInput!
    renderType: NotebookQueryRenderType
    description: String!
}


type NotebookRequestedQueryTypeSpecificProperties @goModel(model: "observe/meta/metatypes.NotebookRequestedQueryTypeSpecificProperties") {
    metric: NotebookMetricQueryRequest
}

input NotebookRequestedQueryTypeSpecificPropertiesInput @goModel(model: "observe/meta/metatypes.NotebookRequestedQueryTypeSpecificPropertiesInput") {
    metric: NotebookMetricQueryRequestInput
}


type NotebookMetricQueryRequest @goModel(model: "observe/meta/metatypes.NotebookMetricQueryRequest") {
    metricID: NotebookMetricQueryId!
    rollup: String
    resolutionMs: Int64
    lookbackMs: Int64
    groupBys: [NotebookRequestedQueryColumnPath!]
    """
    Aggregation function (sum, average, etc) to apply to the metric
    """
    aggregation: String
}

input NotebookMetricQueryRequestInput @goModel(model: "observe/meta/metatypes.NotebookMetricQueryRequestInput") {
    metricID: NotebookMetricQueryIdInput!
    rollup: String
    resolutionMs: Int64
    lookbackMs: Int64
    groupBys: [NotebookRequestedQueryColumnPathInput!]
    aggregation: String
}


type NotebookMetricQueryId @goModel(model: "observe/meta/metatypes.NotebookMetricQueryId") {
    datasetID: String!
    metricName: String!
}

input NotebookMetricQueryIdInput @goModel(model: "observe/meta/metatypes.NotebookMetricQueryIdInput") {
    datasetID: String!
    metricName: String!
}


type NotebookRequestedQueryFilters @goModel(model: "observe/meta/metatypes.NotebookRequestedQueryFilters") {
    field: NotebookRequestedQueryColumnPath!
    value: String!
}

input NotebookRequestedQueryFiltersInput @goModel(model: "observe/meta/metatypes.NotebookRequestedQueryFiltersInput") {
    field: NotebookRequestedQueryColumnPathInput!
    value: String!
}


type NotebookRequestedQueryColumnPath @goModel(model: "observe/meta/metatypes.NotebookRequestedQueryColumnPath") {
    path: String!
    column: String!
}

input NotebookRequestedQueryColumnPathInput @goModel(model: "observe/meta/metatypes.NotebookRequestedQueryColumnPathInput") {
    path: String!
    column: String!
}


type NotebookActionPreview @goModel(model: "observe/meta/metatypes.NotebookActionPreview") {
    text: String!
}

input NotebookActionPreviewInput @goModel(model: "observe/meta/metatypes.NotebookActionPreviewInput") {
    text: String!
}


type NotebookSlackInfo @goModel(model: "observe/meta/metatypes.NotebookSlackInfo") {
    channelName: String!
}

input NotebookSlackInfoInput @goModel(model: "observe/meta/metatypes.NotebookSlackInfoInput") {
    channelName: String!
}


type NotebookRunbookInfo @goModel(model: "observe/meta/metatypes.NotebookRunbookInfo") {
    url: String
    text: String
}

input NotebookRunbookInfoInput @goModel(model: "observe/meta/metatypes.NotebookRunbookInfoInput") {
    url: String
    text: String
}


type NotebookO11yPlaceholder @goModel(model: "observe/meta/metatypes.NotebookO11yPlaceholder") {
    text: String!
}

input NotebookO11yPlaceholderInput @goModel(model: "observe/meta/metatypes.NotebookO11yPlaceholderInput") {
    text: String!
}


type NotebookO11yPromptRecord @goModel(model: "observe/meta/metatypes.NotebookO11yPromptRecord") {
    text: String!
    blockID: String
    choiceID: String
}

input NotebookO11yPromptRecordInput @goModel(model: "observe/meta/metatypes.NotebookO11yPromptRecordInput") {
    text: String!
    blockID: String
    choiceID: String
}


type NotebookQueryLayoutTimeRange @goModel(model: "observe/meta/metatypes.NotebookQueryLayoutTimeRange") {
    startTime: Int64!
    endTime: Int64!
    timeRangeInfo: NotebookQueryLayoutTimeRangeInfo!
    display: String!
    timeZone: String!
}

input NotebookQueryLayoutTimeRangeInput @goModel(model: "observe/meta/metatypes.NotebookQueryLayoutTimeRangeInput") {
    startTime: Int64!
    endTime: Int64!
    timeRangeInfo: NotebookQueryLayoutTimeRangeInfoInput!
    display: String!
    timeZone: String!
}


type NotebookQueryLayoutTimeRangeInfo @goModel(model: "observe/meta/metatypes.NotebookQueryLayoutTimeRangeInfo") {
    key: String!
    value: String!
}

input NotebookQueryLayoutTimeRangeInfoInput @goModel(model: "observe/meta/metatypes.NotebookQueryLayoutTimeRangeInfoInput") {
    key: String!
    value: String!
}


